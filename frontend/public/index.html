<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Pledge Never Again</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="neveragain.tech">
    <meta property="og:description" content="Today we stand together to say: not on our watch, and never again.">
    <meta property="og:url" content="http://neveragain.tech/">
    <meta name="twitter:title" content="neveragain.tech">
    <meta name="twitter:description" content="Today we stand together to say: not on our watch, and never again. ">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <style>
    table.form td { border: none; padding: 0.5em 0; }
    table.form .field { width: 20em; padding-left: 1em; }
    table.form .field input[type="text"] { width: 100%; }
    table.form td.note { width: 30em; opacity: 1; padding-top: 1em; }
    table.form td.note div { font-style: normal; background: #ffc; padding: 0.5em 1em; }
    button { margin-top: 1em !important; }
    input[disabled], button[disabled] { color: #aaa; }
  </style>
  <body>
    <div class="banner">
      <section class="page-header">
        <h1 class="project-name">Sign the neveragain.tech Pledge</h1>
      </section>
    </div>

<section class="main-content">
<div id="legal">
  <p>Please read this site's <a href="/legal.html">Terms of Service and Privacy Policy</a>. By continuing, you agree to be bound by them. They're short, in plain English, and explain what will happen with your data.</p>
</div>

<div id="loading">
  (Loading, just a moment...)
</div>

<div id="signin" style="display: none">
  <p>You can also
  <a href="http://neveragain.tech/">read the text of the pledge here</a>
  if you haven't already.
  </p>
  <p><div id="disclaimer" style="background-color: #FF8888; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
    Note: Your Twitter identity will be stored in Github and available to the public. If you wish to keep this information private, please sign using <a href="https://github.com/neveragaindottech/neveragaindottech.github.io/blob/master/README.md">another method</a>
  </div></p>

  <p>This pledge is for people who work in the US tech industry.
    This doesn't mean you have to be a programmer;
    anyone who is a tech worker by profession,
    either in the US or working at a US-based organization, can sign.
    This includes students planning on going into tech fields, self-employed people, and owners of US-based businesses.
  </p>

  <button id="sign" onclick="sign_in()">To sign the pledge, sign in using Twitter</button>

  <p>If you don't have a Twitter account, see the <a href="https://github.com/neveragaindottech/neveragaindottech.github.io/blob/master/README.md">instructions for other ways to sign the pledge</a>.</p>
</div>

<div id="signed" style="display:none">
  <p>Thanks for signing in.</p>
<form>
  <table class="form" cellpadding=0 cellspacing=0>
    <tr>
      <td colspan=2 class="note">
        <div>
          <strong>Step 1.</strong>
          Please fill in the following information
          to add or update your signature.
          Organization, title, and link are encouraged but optional.
        </div>
    </tr>
    <tr>
      <td><label for="name">Name (required):</label></td>
      <td class="field"><input type="text" id="name" oninput="update_fields()"></td>
    </tr>
    <tr>
      <td><label for="organization">Organization:</label></td>
      <td class="field"><input type="text" id="organization" placeholder="Your company or organization" oninput="update_fields()"></td>
    </tr>
    <tr>
      <td><label for="title">Title:</label></td>
      <td class="field"><input type="text" id="title" placeholder="Your profession or job title"></td>
    </tr>
    <tr>
      <td><label for="link">Link your signature to:</label></td>
      <td class="field"><input type="text" id="link" placeholder="http://"></td>
    </tr>
    <tr>
      <td><label for="linkProfile">Or, link to your Twitter profile</label></td>
      <td class="field"><input type="checkbox" id="linkProfile" onclick="update_fields()"></td>
    </tr>
    <tr>
      <td colspan=2 class="note">
        <div>
          <strong>Step 2.</strong>
          Please provide the URL to an established personal page
          <strong>containing a link to your Twitter account</strong>,
          such as a homepage, blog, Keybase page, or LinkedIn profile.
        </div>
        <div>
          To show your signature on our website,
          we need to verify that your Twitter account
          is accurately represented by the name and organization provided.
        </div>
      </td>
    </tr>
    <tr>
      <td><label for="personalPage">Personal page for verification:</label></td>
      <td class="field"><input type="text" id="personalPage" placeholder="http://" oninput="update_fields()"></td>
    </tr>
    <tbody id="orgDetails" style="display: none">
      <tr>
        <td colspan=2 class="note">
          <div>
            <strong>Step 3.</strong>
            Please help us verify that your organization
            is a US-based tech company or organization, or that you are based in the US.
          </div>
        </td>
      </tr>
      <tr valign="bottom">
        <td><label for="orgDescription">Describe what your<br>organization does:</label></td>
        <td class="field"><input type="text" id="orgDescription" placeholder="A very brief description" oninput="update_fields()"></td>
      </tr>
      <tr valign="bottom">
        <td><label for="orgCountry">In what country is<br>your organization based:</label></td>
        <td class="field"><input type="text" id="orgCountry" placeholder="Country" oninput="update_fields()"></td>
      </tr>
    </tbody>
    <tr>
      <td colspan=2>
        <button type="button" id="pledge" onclick="submit_fields()" disabled>Sign the pledge</button>
      </td>
    </tr>
  </table>
</form>
</div>
<div id="thanks" style="display:none">
<p>Thanks for signing the pledge! We'll manually review the pull request, and updates should go live within 24 hours.</p>
<p>
<a href="https://twitter.com/intent/tweet?text=I%20signed%20the%20@neveragaintech%20pledge.%20Join%20us:%20neveragain.tech">Tweet to tell people you signed the pledge</a>
</p>
<p><a href="http://neveragain.tech/">Return to the pledge</a>
</p>
</div>
<div id="errDiv">
</div>
</section>

<script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyB6h3rfKWEIHaOwX0gKUhVnfBLiTDK9q9k",
    authDomain: "signbot-152613.firebaseapp.com",
    databaseURL: "https://signbot-152613.firebaseio.com",
    storageBucket: "signbot-152613.appspot.com",
    messagingSenderId: "302777097326"
  };
  firebase.initializeApp(config);

  var provider = new firebase.auth.TwitterAuthProvider();
  var elements = {};
  var element_names = [
    'loading', 'signed', 'signin', 'thanks',
    'name', 'organization', 'title', 'link', 'linkProfile', 'personalPage',
    'orgDetails', 'orgDescription', 'orgCountry',
    'errDiv', 'pledge'
  ];
  for (var i = 0; i < element_names.length; i++) {
    var name = element_names[i];
    elements[name] = document.getElementById(name);
  }

  firebase.auth().getRedirectResult().then(function(result) {
    elements.loading.style.display = 'none';
    if (result.credential) {
      // This gives you a the Twitter OAuth 1.0 Access Token and Secret.
      // You can use these server side with your app's credentials to access the Twitter API.
      token = result.credential.accessToken;
      secret = result.credential.secret;
      elements.signed.style.display = 'block';
    } else {
      // Not signed in.
      elements.signin.style.display = 'block';
    }
  }).catch(function(error) {
    // Error signing in.
    elements.errDiv.innerText = error.message;

    // Not signed in.
    elements.signin.style.display = 'block';
  });

  function sign_in() {
    firebase.auth().signInWithRedirect(provider);
  }

  function update_fields() {
    var nameEntered = elements.name.value.trim();
    var orgEntered = elements.organization.value.trim();
    var titleEntered = elements.title.value.trim();
    var personalPageEntered = elements.personalPage.value.trim();
    var onlyNameWithTwitterLink = (!orgEntered && !titleEntered && elements.linkProfile.checked);
    var orgDetailsEntered = (elements.orgDescription.value.trim() && elements.orgCountry.value.trim());

    elements.link.disabled = elements.linkProfile.checked;
    elements.link.placeholder = elements.linkProfile.checked ? '(link will go to your Twitter profile)' : 'http://';
    if (elements.linkProfile.checked) {
      elements.link.value = '';
    }

    elements.orgDetails.style.display = orgEntered ? 'table-row-group' : 'none';
    elements.pledge.disabled = !(
      nameEntered &&
      (orgEntered ? orgDetailsEntered : true) &&
      (onlyNameWithTwitterLink || personalPageEntered)
    );
  }

  function submit_fields() {
    firebase.database().ref('users/' + firebase.auth().currentUser.uid).set({
      name: elements.name.value,
      affiliation: elements.organization.value,
      title: elements.title.value,
      link: elements.link.value,
      linkProfile: elements.linkProfile.checked,
      personalPage: elements.personalPage.value,
      orgDescription: elements.orgDescription.value,
      orgCountry: elements.orgCountry.value,
      twitterToken: token,
      twitterSecret: secret
    }).then(function() {
      elements.signed.style.display = 'none';
      elements.thanks.style.display = 'block';
      elements.errDiv.innerText = '';
      elements.errDiv.style.display = 'none';
    }).catch(function (error) {
      elements.errDiv.innerText = error.message;
    });
  }
</script>

</body>
</html>
